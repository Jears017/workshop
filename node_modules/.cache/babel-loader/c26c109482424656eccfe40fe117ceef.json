{"ast":null,"code":"import _defineProperty from\"/home/jears0177/2021/deploy-workshop/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/home/jears0177/2021/deploy-workshop/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"/home/jears0177/2021/deploy-workshop/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/home/jears0177/2021/deploy-workshop/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import axios from\"axios\";import{setContainerIsEmpty,setProductContainer,setProductValue}from\"../../store/reducers/order\";import{useDispatch,useSelector}from\"react-redux\";import c from'./Create-Order.module.css';import{Redirect}from\"react-router-dom\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var initialState={client:'',number:'',dateEnd:'',productName:'',action:'',price:'',products:[]};export var CreateOrder=function CreateOrder(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),product=_useState2[0],setProduct=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),productFilter=_useState4[0],setProductFilter=_useState4[1];var _useState5=useState(initialState),_useState6=_slicedToArray(_useState5,2),receipt=_useState6[0],setReceipt=_useState6[1];var _useState7=useState(0),_useState8=_slicedToArray(_useState7,2),sum=_useState8[0],setSum=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),fetching=_useState10[0],setFetching=_useState10[1];var dispatch=useDispatch();var state=useSelector(function(state){return state.order;});useEffect(function(){axios.get('https://workshop-application77.herokuapp.com/api/products/').then(function(res){return setProduct(res.data);});},[]);useEffect(function(){setProductFilter(product.map(function(el){return el.name;}));},[product]);var onSubmit=function onSubmit(e){e.preventDefault();var obj={client:receipt.client,number:receipt.number,dateEnd:receipt.dateEnd,productName:receipt.productName,action:receipt.action,products:_toConsumableArray(state.container),sum:sum};axios.post('https://workshop-application77.herokuapp.com/api/receipt/',_objectSpread({},obj));setReceipt(function(prevState){return _objectSpread(_objectSpread({},prevState),{},{client:'',number:'',dateEnd:'',productName:'',action:'',price:''});});dispatch(setContainerIsEmpty());setSum(0);if(receipt.client&&receipt.number&&receipt.dateEnd&&receipt.products){setFetching(true);}};if(receipt.action){axios.get(\"https://workshop-application77.herokuapp.com/api/products/\".concat(receipt.productName,\"/\").concat(receipt.action)).then(function(res){return setReceipt(function(prevState){return _objectSpread(_objectSpread({},prevState),{},{price:res.data[0].price});});});}var formOnChange=function formOnChange(e){setReceipt(function(prevState){return _objectSpread(_objectSpread({},prevState),{},_defineProperty({},e.target.name,e.target.value));});};var addSomeProduct=function addSomeProduct(e){e.preventDefault();dispatch(setProductContainer({productName:receipt.productName,action:receipt.action,price:receipt.price}));setSum(sum+receipt.price);setReceipt(function(prevState){return _objectSpread(_objectSpread({},prevState),{},{productName:'',action:'',price:''});});};var clearCard=function clearCard(){dispatch(setContainerIsEmpty());setSum(0);};if(fetching){return/*#__PURE__*/_jsx(Redirect,{to:'/'});}console.log(new Date().toJSON().slice(0,10));return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:c.title,children:\"\\u041E\\u0444\\u043E\\u0440\\u043C\\u043B\\u0435\\u043D\\u0438\\u0435 \\u0437\\u0430\\u043A\\u0430\\u0437\\u0430:\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:onSubmit,children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"label\",{children:[\"\\u0424\\u0418\\u041E:\",/*#__PURE__*/_jsx(\"input\",{className:\"form-control\",value:receipt.client,name:'client',onChange:formOnChange,placeholder:'Введите ФИО',type:\"text\"})]})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"label\",{children:[\"\\u041D\\u043E\\u043C\\u0435\\u0440:\",/*#__PURE__*/_jsx(\"input\",{className:\"form-control\",value:receipt.number,name:'number',onChange:formOnChange,placeholder:'Введите номер',type:\"number\"})]})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"label\",{children:[\"\\u0414\\u0430\\u0442\\u0430 \\u0433\\u043E\\u0442\\u043E\\u0432\\u043E\\u0433\\u043E \\u0438\\u0437\\u0434\\u0435\\u043B\\u0438\\u044F:\",/*#__PURE__*/_jsx(\"input\",{className:\"form-control\",value:receipt.dateEnd,min:new Date().toJSON().slice(0,10),name:'dateEnd',onChange:formOnChange,type:\"date\"})]})}),/*#__PURE__*/_jsxs(\"div\",{className:c.productSelectContainer,children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"label\",{children:[\"\\u0418\\u0437\\u0434\\u0435\\u043B\\u0438\\u0435:\",/*#__PURE__*/_jsx(\"div\",{className:c.selectSettings,children:/*#__PURE__*/_jsxs(\"select\",{className:\"form-select\",value:receipt.productName,name:\"productName\",onChange:formOnChange,children:[/*#__PURE__*/_jsx(\"option\",{children:\"\\u0412\\u044B\\u0431\\u0435\\u0440\\u0438\\u0442\\u0435 \\u043E\\u0434\\u0435\\u0436\\u0434\\u0443\"}),productFilter.filter(function(el,idx){return productFilter.indexOf(el)===idx;}).map(function(prod){return/*#__PURE__*/_jsx(\"option\",{value:prod,children:prod},prod);})]})})]})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"label\",{children:[\"\\u0414\\u0435\\u0439\\u0441\\u0442\\u0432\\u0438\\u0435:\",/*#__PURE__*/_jsx(\"div\",{className:c.selectSettings,children:/*#__PURE__*/_jsxs(\"select\",{className:\"form-select\",value:receipt.action,name:\"action\",onChange:formOnChange,children:[/*#__PURE__*/_jsx(\"option\",{children:\"\\u0412\\u044B\\u0431\\u0435\\u0440\\u0438\\u0442\\u0435 \\u0434\\u0435\\u0439\\u0441\\u0442\\u0432\\u0438\\u0435\"}),product.filter(function(prod){return prod.name===receipt.productName;}).map(function(prod){return/*#__PURE__*/_jsx(\"option\",{value:prod.action,children:prod.action},prod._id);})]})})]})}),/*#__PURE__*/_jsx(\"div\",{className:c.productButton,children:/*#__PURE__*/_jsx(\"input\",{onClick:addSomeProduct,className:\"btn btn-primary\",value:'add',type:\"button\"})}),state.container.length!=0&&/*#__PURE__*/_jsx(\"div\",{className:c.productButton,children:/*#__PURE__*/_jsx(\"input\",{onClick:clearCard,className:\"btn btn-primary\",value:'clear',type:\"button\"})})]}),state.container.length!=0&&/*#__PURE__*/_jsx(\"div\",{className:c.table,children:/*#__PURE__*/_jsxs(\"table\",{className:\"table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"#\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"\\u0418\\u0437\\u0434\\u0435\\u043B\\u0438\\u0435\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"\\u041F\\u0435\\u0440\\u0435\\u0447\\u0435\\u043D\\u044C \\u0440\\u0430\\u0431\\u043E\\u0442\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"\\u0421\\u0442\\u043E\\u0438\\u043C\\u043E\\u0441\\u0442\\u044C\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:state.container.map(function(el,index){return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{scope:\"row\",children:index+1}),/*#__PURE__*/_jsx(\"td\",{children:el.productName}),/*#__PURE__*/_jsx(\"td\",{children:el.action}),/*#__PURE__*/_jsxs(\"td\",{children:[el.price,\" \\u0440\\u0443\\u0431.\"]})]},index);})})]})}),state.container.length!=0&&/*#__PURE__*/_jsxs(\"div\",{children:[\"\\u0418\\u0442\\u043E\\u0433\\u043E: \",sum,\" \\u0440\\u0443\\u0431.\"]}),/*#__PURE__*/_jsx(\"div\",{className:c.submitBtn,children:/*#__PURE__*/_jsx(\"input\",{className:\"btn btn-primary\",type:\"submit\",value:'Добавить заказ'})})]})]});};","map":{"version":3,"sources":["/home/jears0177/2021/deploy-workshop/client/src/components/Create-Order/Create-Order.js"],"names":["React","useEffect","useState","axios","setContainerIsEmpty","setProductContainer","setProductValue","useDispatch","useSelector","c","Redirect","initialState","client","number","dateEnd","productName","action","price","products","CreateOrder","product","setProduct","productFilter","setProductFilter","receipt","setReceipt","sum","setSum","fetching","setFetching","dispatch","state","order","get","then","res","data","map","el","name","onSubmit","e","preventDefault","obj","container","post","prevState","formOnChange","target","value","addSomeProduct","clearCard","console","log","Date","toJSON","slice","title","productSelectContainer","selectSettings","filter","idx","indexOf","prod","_id","productButton","length","table","index","submitBtn"],"mappings":"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","sourcesContent":["import React, {useEffect, useState} from 'react'\nimport axios from \"axios\";\nimport {setContainerIsEmpty, setProductContainer, setProductValue} from \"../../store/reducers/order\";\nimport {useDispatch, useSelector} from \"react-redux\";\nimport c from './Create-Order.module.css'\nimport {Redirect} from \"react-router-dom\";\n\nconst initialState = {\n    client: '',\n    number: '',\n    dateEnd: '',\n    productName: '',\n    action: '',\n    price: '',\n    products: []\n}\n\nexport const CreateOrder = () => {\n    const [product, setProduct] = useState([])\n    const [productFilter, setProductFilter] = useState([])\n    const [receipt, setReceipt] = useState(initialState)\n    const [sum, setSum] = useState(0)\n    const [fetching, setFetching] = useState(false)\n\n    const dispatch = useDispatch()\n    const state = useSelector(state => state.order)\n\n\n    useEffect(() => {\n        axios.get('https://workshop-application77.herokuapp.com/api/products/').then(res => setProduct(res.data))\n    }, [])\n\n    useEffect(() => {\n        setProductFilter(product.map(el => el.name))\n    }, [product])\n\n    const onSubmit = (e) => {\n        e.preventDefault()\n        const obj = {\n            client: receipt.client,\n            number: receipt.number,\n            dateEnd: receipt.dateEnd,\n            productName: receipt.productName,\n            action: receipt.action,\n            products: [...state.container],\n            sum: sum\n        }\n        axios.post('https://workshop-application77.herokuapp.com/api/receipt/', {...obj})\n        setReceipt(prevState => {\n            return {...prevState, client: '', number: '', dateEnd: '', productName: '', action: '', price: '',}\n        })\n        dispatch(setContainerIsEmpty())\n        setSum(0)\n        if (receipt.client && receipt.number && receipt.dateEnd && receipt.products) {\n            setFetching(true)\n        }\n    }\n\n    if (receipt.action) {\n        axios.get(`https://workshop-application77.herokuapp.com/api/products/${receipt.productName}/${receipt.action}`).then(res => setReceipt(prevState => {\n            return {...prevState, price: res.data[0].price}\n        }))\n    }\n\n    const formOnChange = (e) => {\n        setReceipt(prevState => {\n            return {...prevState, [e.target.name]: e.target.value}\n        })\n    }\n\n    const addSomeProduct = (e) => {\n        e.preventDefault()\n        dispatch(setProductContainer({\n            productName: receipt.productName,\n            action: receipt.action,\n            price: receipt.price,\n        }))\n        setSum(sum + receipt.price)\n        setReceipt(prevState => {\n            return {...prevState, productName: '', action: '', price: ''}\n        })\n    }\n\n    const clearCard = () => {\n        dispatch(setContainerIsEmpty())\n        setSum(0)\n    }\n\n    if (fetching) {\n        return <Redirect to={'/'}/>\n    }\n\n    console.log(new Date().toJSON().slice(0,10))\n\n\n    return (\n        <div>\n            <h2 className={c.title}>Оформление заказа:</h2>\n            <form onSubmit={onSubmit}>\n                <div>\n                    <label>\n                        ФИО:\n                        <input\n                            className=\"form-control\"\n                            value={receipt.client}\n                            name={'client'}\n                            onChange={formOnChange}\n                            placeholder={'Введите ФИО'}\n                            type=\"text\"\n                        />\n                    </label>\n                </div>\n                <div>\n                    <label>\n                        Номер:\n                        <input\n                            className=\"form-control\"\n                            value={receipt.number}\n                            name={'number'}\n                            onChange={formOnChange}\n                            placeholder={'Введите номер'}\n                            type=\"number\"\n                        />\n                    </label>\n                </div>\n                <div>\n                    <label>\n                        Дата готового изделия:\n                        <input\n                            className=\"form-control\"\n                            value={receipt.dateEnd}\n                            min={new Date().toJSON().slice(0,10)}\n                            name={'dateEnd'}\n                            onChange={formOnChange}\n                            type=\"date\"\n                        />\n                    </label>\n                </div>\n                <div className={c.productSelectContainer}>\n                    <div>\n                        <label>\n                            Изделие:\n                            <div className={c.selectSettings}>\n                                <select className=\"form-select\" value={receipt.productName} name='productName'\n                                        onChange={formOnChange}>\n                                    <option>Выберите одежду</option>\n                                    {productFilter.filter((el, idx) => productFilter.indexOf(el) === idx).map(prod => {\n                                        return (\n                                            <option value={prod} key={prod}>{prod}</option>\n                                        )\n                                    })}\n                                </select>\n                            </div>\n                        </label>\n                    </div>\n                    <div>\n                        <label>\n                            Действие:\n                            <div className={c.selectSettings}>\n                                <select className=\"form-select\" value={receipt.action} name='action'\n                                        onChange={formOnChange}>\n                                    <option>Выберите действие</option>\n                                    {product.filter(prod => prod.name === receipt.productName).map(prod => {\n                                        return (\n                                            <option value={prod.action} key={prod._id}>{prod.action}</option>\n                                        )\n                                    })}\n                                </select>\n                            </div>\n                        </label>\n                    </div>\n                    <div className={c.productButton}>\n                        <input onClick={addSomeProduct} className=\"btn btn-primary\" value={'add'} type=\"button\"/>\n                    </div>\n                    {state.container.length != 0 && <div className={c.productButton}>\n                        <input onClick={clearCard} className=\"btn btn-primary\" value={'clear'} type=\"button\"/>\n                    </div>\n                    }\n                </div>\n                {state.container.length != 0 && <div className={c.table}>\n                    <table className=\"table\">\n                        <thead>\n                        <tr>\n                            <th scope=\"col\">#</th>\n                            <th scope=\"col\">Изделие</th>\n                            <th scope=\"col\">Перечень работ</th>\n                            <th scope=\"col\">Стоимость</th>\n                        </tr>\n                        </thead>\n                        <tbody>\n                        {state.container.map((el, index) => {\n                            return (\n                                <tr key={index}>\n                                    <th scope=\"row\">{index + 1}</th>\n                                    <td>{el.productName}</td>\n                                    <td>{el.action}</td>\n                                    <td>{el.price} руб.</td>\n                                </tr>\n                            )\n                        })}\n                        </tbody>\n                    </table>\n                </div>}\n                {state.container.length != 0 && <div>Итого: {sum} руб.</div>}\n                <div className={c.submitBtn}>\n                    <input className=\"btn btn-primary\" type=\"submit\" value={'Добавить заказ'}/>\n                </div>\n            </form>\n        </div>\n    )\n}"]},"metadata":{},"sourceType":"module"}