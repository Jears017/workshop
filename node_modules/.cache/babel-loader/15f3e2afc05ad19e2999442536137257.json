{"ast":null,"code":"import _defineProperty from\"/home/jears0177/2021/deploy-workshop/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _toConsumableArray from\"/home/jears0177/2021/deploy-workshop/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/home/jears0177/2021/deploy-workshop/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/home/jears0177/2021/deploy-workshop/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import axios from\"axios\";import{setContainerIsEmpty,setProductContainer,setProductValue}from\"../../store/reducers/order\";import{useDispatch,useSelector}from\"react-redux\";import c from'./Edit-Order.module.css';import{Redirect}from\"react-router-dom\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var initialState={client:'',number:'',dateEnd:'',productName:'',action:'',price:'',products:[],sum:''};export var EditOrder=function EditOrder(props){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),product=_useState2[0],setProduct=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),productFilter=_useState4[0],setProductFilter=_useState4[1];var _useState5=useState(initialState),_useState6=_slicedToArray(_useState5,2),receipt=_useState6[0],setReceipt=_useState6[1];var _useState7=useState(0),_useState8=_slicedToArray(_useState7,2),sum=_useState8[0],setSum=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),fetching=_useState10[0],setFetching=_useState10[1];var dispatch=useDispatch();var state=useSelector(function(state){return state.order;});useEffect(function(){axios.get(\"https://workshop-application77.herokuapp.com/api/receipt/\".concat(props.match.params.id)).then(function(res){return setReceipt(function(prevState){return _objectSpread(_objectSpread({},prevState),{},{client:res.data.client,number:res.data.number,dateEnd:res.data.dateEnd,products:_toConsumableArray(res.data.products),sum:res.data.sum});});});},[]);useEffect(function(){axios.get('https://workshop-application77.herokuapp.com/api/products/').then(function(res){setProduct(res.data);setSum(receipt.sum);});},[receipt.sum]);useEffect(function(){setProductFilter(product.map(function(el){return el.name;}));},[product]);var onSubmit=function onSubmit(e){e.preventDefault();var obj={client:receipt.client,number:receipt.number,dateEnd:receipt.dateEnd,productName:receipt.productName,action:receipt.action,products:_toConsumableArray(receipt.products),sum:sum};axios.put(\"https://workshop-application77.herokuapp.com/api/receipt/\".concat(props.match.params.id),_objectSpread({},obj));setReceipt(function(prevState){return _objectSpread(_objectSpread({},prevState),{},{client:'',number:'',dateEnd:'',productName:'',action:'',price:'',sum:'',products:[]});});setSum(0);if(receipt.client&&receipt.number&&receipt.products){setFetching(true);}};if(receipt.action){axios.get(\"https://workshop-application77.herokuapp.com/api/products/\".concat(receipt.productName,\"/\").concat(receipt.action)).then(function(res){return setReceipt(function(prevState){return _objectSpread(_objectSpread({},prevState),{},{price:res.data[0].price});});});}var formOnChange=function formOnChange(e){setReceipt(function(prevState){return _objectSpread(_objectSpread({},prevState),{},_defineProperty({},e.target.name,e.target.value));});};var addSomeProduct=function addSomeProduct(e){e.preventDefault();var product={productName:receipt.productName,action:receipt.action,price:receipt.price};setReceipt(function(prevState){return _objectSpread(_objectSpread({},prevState),{},{products:[].concat(_toConsumableArray(prevState.products),[product])});});setSum(sum+receipt.price);setReceipt(function(prevState){return _objectSpread(_objectSpread({},prevState),{},{productName:'',action:'',price:''});});};var clearCard=function clearCard(){setReceipt(function(prevState){return _objectSpread(_objectSpread({},prevState),{},{products:[]});});setSum(0);};if(fetching){return/*#__PURE__*/_jsx(Redirect,{to:'/'});}return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:c.title,children:\"\\u0420\\u0435\\u0434\\u0430\\u043A\\u0442\\u0438\\u0440\\u043E\\u0432\\u0430\\u043D\\u0438\\u0435 \\u0437\\u0430\\u043A\\u0430\\u0437\\u0430:\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:onSubmit,children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"label\",{children:[\"\\u0424\\u0418\\u041E:\",/*#__PURE__*/_jsx(\"input\",{className:\"form-control\",value:receipt.client,name:'client',onChange:formOnChange,placeholder:'Введите ФИО',type:\"text\"})]})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"label\",{children:[\"\\u041D\\u043E\\u043C\\u0435\\u0440:\",/*#__PURE__*/_jsx(\"input\",{className:\"form-control\",value:receipt.number,name:'number',onChange:formOnChange,placeholder:'Введите номер',type:\"number\"})]})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"label\",{children:[\"\\u0414\\u0430\\u0442\\u0430 \\u0433\\u043E\\u0442\\u043E\\u0432\\u043E\\u0433\\u043E \\u0438\\u0437\\u0434\\u0435\\u043B\\u0438\\u044F:\",/*#__PURE__*/_jsx(\"input\",{className:\"form-control\",value:receipt.dateEnd,name:'dateEnd',onChange:formOnChange,type:\"date\"})]})}),/*#__PURE__*/_jsxs(\"div\",{className:c.productSelectContainer,children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"label\",{children:[\"\\u0418\\u0437\\u0434\\u0435\\u043B\\u0438\\u0435:\",/*#__PURE__*/_jsxs(\"select\",{className:\"form-select\",value:receipt.productName,name:\"productName\",onChange:formOnChange,children:[/*#__PURE__*/_jsx(\"option\",{children:\"\\u0412\\u044B\\u0431\\u0435\\u0440\\u0438\\u0442\\u0435 \\u043E\\u0434\\u0435\\u0436\\u0434\\u0443\"}),productFilter.filter(function(el,idx){return productFilter.indexOf(el)===idx;}).map(function(prod){return/*#__PURE__*/_jsx(\"option\",{value:prod,children:prod},prod);})]})]})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"label\",{children:[\"\\u0414\\u0435\\u0439\\u0441\\u0442\\u0432\\u0438\\u0435:\",/*#__PURE__*/_jsxs(\"select\",{className:\"form-select\",value:receipt.action,name:\"action\",onChange:formOnChange,children:[/*#__PURE__*/_jsx(\"option\",{children:\"\\u0412\\u044B\\u0431\\u0435\\u0440\\u0438\\u0442\\u0435 \\u0434\\u0435\\u0439\\u0441\\u0442\\u0432\\u0438\\u0435\"}),product.filter(function(prod){return prod.name===receipt.productName;}).map(function(prod){return/*#__PURE__*/_jsx(\"option\",{value:prod.action,children:prod.action},prod._id);})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:c.productButton,children:/*#__PURE__*/_jsx(\"input\",{onClick:addSomeProduct,className:\"btn btn-primary\",value:'add',type:\"button\"})}),/*#__PURE__*/_jsx(\"div\",{className:c.productButton,children:/*#__PURE__*/_jsx(\"input\",{onClick:clearCard,className:\"btn btn-primary\",value:'clear',type:\"button\"})})]}),receipt.products.length!=0&&/*#__PURE__*/_jsx(\"div\",{className:c.table,children:/*#__PURE__*/_jsxs(\"table\",{className:\"table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"#\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"\\u0418\\u0437\\u0434\\u0435\\u043B\\u0438\\u0435\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"\\u041F\\u0435\\u0440\\u0435\\u0447\\u0435\\u043D\\u044C \\u0440\\u0430\\u0431\\u043E\\u0442\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"\\u0421\\u0442\\u043E\\u0438\\u043C\\u043E\\u0441\\u0442\\u044C\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:receipt.products.map(function(el,index){return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{scope:\"row\",children:index+1}),/*#__PURE__*/_jsx(\"td\",{children:el.productName}),/*#__PURE__*/_jsx(\"td\",{children:el.action}),/*#__PURE__*/_jsxs(\"td\",{children:[el.price,\" \\u0440\\u0443\\u0431.\"]})]},index);})})]})}),receipt.products.length!=0&&/*#__PURE__*/_jsxs(\"div\",{children:[\"\\u0418\\u0442\\u043E\\u0433\\u043E: \",sum,\" \\u0440\\u0443\\u0431.\"]}),/*#__PURE__*/_jsx(\"div\",{className:c.submitBtn,children:/*#__PURE__*/_jsx(\"input\",{className:\"btn btn-primary\",type:\"submit\",value:'Добавить заказ'})})]})]});};","map":{"version":3,"sources":["/home/jears0177/2021/deploy-workshop/client/src/components/Edit-Order/Edit-Order.js"],"names":["React","useEffect","useState","axios","setContainerIsEmpty","setProductContainer","setProductValue","useDispatch","useSelector","c","Redirect","initialState","client","number","dateEnd","productName","action","price","products","sum","EditOrder","props","product","setProduct","productFilter","setProductFilter","receipt","setReceipt","setSum","fetching","setFetching","dispatch","state","order","get","match","params","id","then","res","prevState","data","map","el","name","onSubmit","e","preventDefault","obj","put","formOnChange","target","value","addSomeProduct","clearCard","title","productSelectContainer","filter","idx","indexOf","prod","_id","productButton","length","table","index","submitBtn"],"mappings":"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","sourcesContent":["import React, {useEffect, useState} from 'react'\nimport axios from \"axios\";\nimport {setContainerIsEmpty, setProductContainer, setProductValue} from \"../../store/reducers/order\";\nimport {useDispatch, useSelector} from \"react-redux\";\nimport c from './Edit-Order.module.css'\nimport {Redirect} from \"react-router-dom\";\n\nconst initialState = {\n    client: '',\n    number: '',\n    dateEnd: '',\n    productName: '',\n    action: '',\n    price: '',\n    products: [],\n    sum: ''\n}\n\nexport const EditOrder = (props) => {\n    const [product, setProduct] = useState([])\n    const [productFilter, setProductFilter] = useState([])\n    const [receipt, setReceipt] = useState(initialState)\n    const [sum, setSum] = useState(0)\n    const [fetching, setFetching] = useState(false)\n\n    const dispatch = useDispatch()\n    const state = useSelector(state => state.order)\n\n\n    useEffect(() => {\n        axios.get(`https://workshop-application77.herokuapp.com/api/receipt/${props.match.params.id}`).then(res => setReceipt(prevState => {\n            return {\n                ...prevState,\n                client: res.data.client,\n                number: res.data.number,\n                dateEnd: res.data.dateEnd,\n                products: [...res.data.products],\n                sum: res.data.sum\n            }\n\n        }))\n    }, [])\n\n    useEffect(() => {\n        axios.get('https://workshop-application77.herokuapp.com/api/products/').then(res => {\n            setProduct(res.data)\n            setSum(receipt.sum)\n        })\n    }, [receipt.sum])\n\n    useEffect(() => {\n        setProductFilter(product.map(el => el.name))\n    }, [product])\n\n    const onSubmit = (e) => {\n        e.preventDefault()\n        const obj = {\n            client: receipt.client,\n            number: receipt.number,\n            dateEnd: receipt.dateEnd,\n            productName: receipt.productName,\n            action: receipt.action,\n            products: [...receipt.products],\n            sum: sum\n        }\n        axios.put(`https://workshop-application77.herokuapp.com/api/receipt/${props.match.params.id}`, {...obj})\n        setReceipt(prevState => {\n            return {\n                ...prevState,\n                client: '',\n                number: '',\n                dateEnd: '',\n                productName: '',\n                action: '',\n                price: '',\n                sum: '',\n                products: []\n            }\n        })\n        setSum(0)\n        if (receipt.client && receipt.number && receipt.products) {\n            setFetching(true)\n        }\n    }\n\n    if (receipt.action) {\n        axios.get(`https://workshop-application77.herokuapp.com/api/products/${receipt.productName}/${receipt.action}`).then(res => setReceipt(prevState => {\n            return {...prevState, price: res.data[0].price}\n        }))\n    }\n\n    const formOnChange = (e) => {\n        setReceipt(prevState => {\n            return {...prevState, [e.target.name]: e.target.value}\n        })\n    }\n\n    const addSomeProduct = (e) => {\n        e.preventDefault()\n        const product = {\n            productName: receipt.productName,\n            action: receipt.action,\n            price: receipt.price,\n        }\n        setReceipt(prevState => {\n            return {...prevState, products: [...prevState.products, product]}\n        })\n        setSum(sum + receipt.price)\n        setReceipt(prevState => {\n            return {...prevState, productName: '', action: '', price: ''}\n        })\n    }\n\n    const clearCard = () => {\n        setReceipt(prevState => {\n            return {...prevState, products: []}\n        })\n        setSum(0)\n    }\n\n    if (fetching) {\n        return <Redirect to={'/'}/>\n    }\n\n    return (\n        <div>\n            <h2 className={c.title}>Редактирование заказа:</h2>\n            <form onSubmit={onSubmit}>\n                <div>\n                    <label>\n                        ФИО:\n                        <input\n                            className=\"form-control\"\n                            value={receipt.client}\n                            name={'client'}\n                            onChange={formOnChange}\n                            placeholder={'Введите ФИО'}\n                            type=\"text\"\n                        />\n                    </label>\n                </div>\n                <div>\n                    <label>\n                        Номер:\n                        <input\n                            className=\"form-control\"\n                            value={receipt.number}\n                            name={'number'}\n                            onChange={formOnChange}\n                            placeholder={'Введите номер'}\n                            type=\"number\"\n                        />\n                    </label>\n                </div>\n                <div>\n                    <label>\n                        Дата готового изделия:\n                        <input\n                            className=\"form-control\"\n                            value={receipt.dateEnd}\n                            name={'dateEnd'}\n                            onChange={formOnChange}\n                            type=\"date\"\n                        />\n                    </label>\n                </div>\n                <div className={c.productSelectContainer}>\n                    <div>\n                        <label>\n                            Изделие:\n                            <select className=\"form-select\" value={receipt.productName} name='productName'\n                                    onChange={formOnChange}>\n                                <option>Выберите одежду</option>\n                                {productFilter.filter((el, idx) => productFilter.indexOf(el) === idx).map(prod => {\n                                    return (\n                                        <option value={prod} key={prod}>{prod}</option>\n                                    )\n                                })}\n                            </select>\n                        </label>\n                    </div>\n                    <div>\n                        <label>\n                            Действие:\n                            <select className=\"form-select\" value={receipt.action} name='action'\n                                    onChange={formOnChange}>\n                                <option>Выберите действие</option>\n                                {product.filter(prod => prod.name === receipt.productName).map(prod => {\n                                    return (\n                                        <option value={prod.action} key={prod._id}>{prod.action}</option>\n                                    )\n                                })}\n                            </select>\n                        </label>\n                    </div>\n                    <div className={c.productButton}>\n                        <input onClick={addSomeProduct} className=\"btn btn-primary\" value={'add'} type=\"button\"/>\n                    </div>\n                    <div className={c.productButton}>\n                        <input onClick={clearCard} className=\"btn btn-primary\" value={'clear'} type=\"button\"/>\n                    </div>\n                </div>\n                {receipt.products.length != 0 && <div className={c.table}>\n                    <table className=\"table\">\n                        <thead>\n                        <tr>\n                            <th scope=\"col\">#</th>\n                            <th scope=\"col\">Изделие</th>\n                            <th scope=\"col\">Перечень работ</th>\n                            <th scope=\"col\">Стоимость</th>\n                        </tr>\n                        </thead>\n                        <tbody>\n                        {receipt.products.map((el, index) => {\n                            return (\n                                <tr key={index}>\n                                    <th scope=\"row\">{index + 1}</th>\n                                    <td>{el.productName}</td>\n                                    <td>{el.action}</td>\n                                    <td>{el.price} руб.</td>\n                                </tr>\n                            )\n                        })}\n                        </tbody>\n                    </table>\n                </div>}\n                {receipt.products.length != 0 && <div>Итого: {sum} руб.</div>}\n                <div className={c.submitBtn}>\n                    <input className=\"btn btn-primary\" type=\"submit\" value={'Добавить заказ'}/>\n                </div>\n            </form>\n        </div>\n    )\n}"]},"metadata":{},"sourceType":"module"}